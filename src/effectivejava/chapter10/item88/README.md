# 保护性地编写 readObject 方法

## 小结

总之，在编写 readObject 方法的时候，都要这样想：

你正在编写一个公有构造器，无论给它传递什么样的字节流，它都必须产生一个有效的实例。不要假设这个字节流一定代表着一个真正被序列化的实例。

> 虽然在本条目的例子中，类使用了默认的序列化形式，但是所有讨论到的有可能发生的问题也同样适用于自定义序列化形式的类。

下面给出一些指导建议，有助于编写出更健壮的 readObject 方法:

- 类中的对象引用字段必须保持为**私有属性**，要**保护性的拷贝**这些字段中的每个对象。不可变类中的可变组件就属于这一类别

- 对于任何约束条件，如果检查失败就抛出一个 InvalidObjectException 异常。这些检查动作应该跟在所有的**保护性拷贝之后。**

- 如果整个对象图在被反序列化之后必须进行验证，就应该使用 ObjectInputValidation 接口（本书没有讨论）。

- 无论是直接方法还是间接方法，都**不要调用类中任何可被覆盖的方法。**