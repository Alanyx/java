# 优先选择 Java 序列化的替代方案

## 为什么尽量不要序列化?

序列化的根本问题：可攻击的范围太大，难以保护且问题不断增多。

> 一个事实:即使履行了所有相关的最佳建议，成功地编写了不受攻击的可序列化类，应用程序仍然可能是脆弱的。

### gadget

攻击者和安全研究人员研究 Java 库和常用的第三方库中的可序列化类型，寻找在反序列化过程中调用的潜在危险活动的方法称为 gadget。

> 不使用任何 gadget，你都可以通过对需要很长时间才能反序列化的短流进行反序列化，轻松地发起拒绝服务攻击。这种流被称为反序列化炸弹 [见示例代码 BombDemo]。

## 原则

避免序列化利用的最好方法是永远不要反序列化任何东西。


## 建议

### 跨平台结构数据表示
使用其他一些机制可以在对象和字节序列之间进行转换，避免了 Java 序列化的许多危险，同时还提供了许多优势，称为跨平台结构数据表示。

> 领先的跨平台结构化数据表示是 JSON 和 Protocol Buffers，也称为 protobuf。

类别|特点
---|----
JSON|基于文本的，并且是人类可读
protobuf|二进制的，但效率更高

### 无法避免的序列化

- 历史遗留系统，永远不要反序列化不可信的数据。

- 如果无法避免序列化，并且不能绝对确定反序列化数据的安全性，可以使用 Java 9 中添加的对象反序列化筛选，并将其移植到早期版本（java.io.ObjectInputFilter）

**优先选择白名单而不是黑名单。**

> 该工具允许你指定一个过滤器，该过滤器在反序列化数据流之前应用于数据流。它在类粒度上运行，允许你接受或拒绝某些类。
>
> 默认接受所有类，并拒绝已知潜在危险类的列表称为黑名单；在默认情况下拒绝其他类，并接受假定安全的类的列表称为白名单。


## 小结

总之，序列化很危险，应该避免。

如果你从头开始设计一个系统，可以使用跨平台的结构化数据，如 JSON 或 protobuf。

不要反序列化不可信的数据。

如果必须这序列化，请使用对象反序列化过滤，但要注意，它不能保证阻止所有攻击。

避免编写可序列化的类。如果你必须这样做，一定要非常小心。